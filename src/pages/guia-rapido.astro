---
/**
 * guia-rapido.astro
 * Página do Guia de Consulta Rápida
 * Referência prática ao lado do leito
 * Conteúdo carregado via Content Collection
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import PageHeader from '../components/PageHeader.astro';
import TableOfContents from '../components/TableOfContents.astro';
import { getEntry } from 'astro:content';

const guia = await getEntry('guia-rapido', 'index');
const { Content, headings } = await guia.render();
---

<BaseLayout title={guia.data.title} description={guia.data.description}>
  <article class="guide-page">
    <PageHeader
      title={guia.data.title}
      subtitle={guia.data.subtitle}
    />

    <!-- Conteúdo com sidebar -->
    <div class="guide-layout">
      <div class="guide-content">
        <Content />

        <footer class="guide-footer">
          <p><strong>Fonte:</strong> Curso de Antimicrobianos — HRT</p>
          <p><strong>Última atualização:</strong> {guia.data.lastUpdated}</p>
          <p><em>Consultar texto de referência dos módulos para informações completas.</em></p>
        </footer>
      </div>

      <!-- Sidebar com navegação -->
      <aside class="guide-sidebar">
        <div class="guide-sidebar__sticky">
          <!-- Navegação principal -->
          <div class="guide-sidebar__nav-section">
            <h3 class="guide-sidebar__title">Navegação</h3>
            <nav class="guide-sidebar__nav">
              <a href="/" class="guide-sidebar__link">
                ← Página Inicial
              </a>
              <a href="/modulos" class="guide-sidebar__link">
                Módulos do Curso
              </a>
              <a href="/sobre" class="guide-sidebar__link">
                Sobre o Curso
              </a>
            </nav>
          </div>

          <!-- Table of Contents (Desktop) - com scroll independente -->
          <div class="guide-sidebar__toc-wrapper">
            <TableOfContents headings={headings} maxDepth={3} variant="desktop" />
          </div>
        </div>
      </aside>
    </div>
  </article>

  <!-- Table of Contents Mobile (FAB) - fora do article para evitar contexto de stacking -->
  <TableOfContents headings={headings} maxDepth={3} variant="mobile" />
</BaseLayout>

<style>
  .guide-page {
    background: var(--color-cream);
  }

  /* Layout com sidebar */
  .guide-layout {
    display: grid;
    grid-template-columns: 1fr 260px;
    gap: var(--space-xl);
    max-width: 1100px;
    margin: 0 auto;
    padding: var(--space-xl) var(--space-lg);
  }

  /* Container do conteúdo markdown */
  .guide-content {
    min-width: 0;
    max-width: 100%;
  }

  /* Prevenir overflow em todos os elementos */
  .guide-content :global(*) {
    max-width: 100%;
    box-sizing: border-box;
  }

  /* Headings */
  .guide-content :global(h2) {
    font-family: var(--font-display);
    font-size: var(--text-2xl);
    color: var(--color-blood-red);
    margin: var(--space-2xl) 0 var(--space-lg);
    padding-bottom: var(--space-sm);
    border-bottom: 2px solid var(--color-gold);
  }

  .guide-content :global(h2:first-child) {
    margin-top: 0;
  }

  .guide-content :global(h3) {
    font-family: var(--font-display);
    font-size: var(--text-xl);
    color: var(--color-sepia-dark);
    margin: var(--space-xl) 0 var(--space-md);
  }

  .guide-content :global(h4) {
    font-family: var(--font-headline);
    font-size: var(--text-lg);
    color: var(--color-sepia-medium);
    margin: var(--space-lg) 0 var(--space-sm);
  }

  /* Parágrafos */
  .guide-content :global(p) {
    margin-bottom: var(--space-md);
    line-height: 1.7;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  /* Listas */
  .guide-content :global(ul),
  .guide-content :global(ol) {
    margin-bottom: var(--space-lg);
    padding-left: var(--space-xl);
  }

  .guide-content :global(li) {
    margin-bottom: var(--space-sm);
    line-height: 1.6;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  /* Tabelas */
  .guide-content :global(table) {
    border-collapse: collapse;
    margin: var(--space-lg) 0;
    font-size: var(--text-sm);
    background: var(--color-cream-light);
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--shadow-md);
    display: block;
    overflow-x: auto;
    max-width: 100%;
    -webkit-overflow-scrolling: touch;
  }

  .guide-content :global(thead) {
    background: linear-gradient(180deg, var(--color-burgundy) 0%, var(--color-sepia-dark) 100%);
  }

  .guide-content :global(th) {
    color: var(--text-light);
    font-family: var(--font-headline);
    font-weight: 600;
    text-align: left;
    padding: var(--space-md);
    letter-spacing: 0.02em;
    text-transform: uppercase;
    font-size: var(--text-xs);
  }

  .guide-content :global(td) {
    padding: var(--space-sm) var(--space-md);
    border-bottom: 1px solid var(--color-parchment);
    vertical-align: top;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .guide-content :global(tbody tr:hover) {
    background: rgba(139, 21, 56, 0.05);
  }

  .guide-content :global(tbody tr:last-child td) {
    border-bottom: none;
  }

  /* Código inline */
  .guide-content :global(code) {
    background: var(--color-cream-dark);
    padding: 0.15em 0.4em;
    border-radius: 3px;
    font-size: 0.9em;
    font-family: var(--font-mono);
    word-break: break-word;
  }

  /* Blockquotes */
  .guide-content :global(blockquote) {
    margin: var(--space-lg) 0;
    padding: var(--space-md) var(--space-lg);
    background: rgba(201, 162, 39, 0.1);
    border-left: 4px solid var(--color-gold);
    border-radius: 0 var(--border-radius) var(--border-radius) 0;
  }

  .guide-content :global(blockquote p) {
    margin-bottom: var(--space-sm);
  }

  .guide-content :global(blockquote p:last-child) {
    margin-bottom: 0;
  }

  .guide-content :global(blockquote strong) {
    color: var(--color-blood-red);
  }

  /* Horizontal rules */
  .guide-content :global(hr) {
    border: none;
    border-top: 2px solid var(--color-parchment);
    margin: var(--space-2xl) 0;
  }

  /* Enfatizados */
  .guide-content :global(strong) {
    color: var(--color-blood-red);
    font-weight: 600;
  }

  .guide-content :global(em) {
    font-style: italic;
    color: var(--text-secondary);
  }

  /* Footer */
  .guide-footer {
    margin-top: var(--space-2xl);
    padding-top: var(--space-xl);
    text-align: center;
    border-top: 2px solid var(--color-parchment);
    color: var(--text-secondary);
    font-size: var(--text-sm);
  }

  .guide-footer p {
    margin-bottom: var(--space-sm);
  }

  /* Sidebar */
  .guide-sidebar {
    font-size: var(--text-sm);
  }

  .guide-sidebar__sticky {
    position: sticky;
    top: calc(60px + var(--space-lg));
    max-height: calc(100vh - 60px - var(--space-xl));
    display: flex;
    flex-direction: column;
  }

  .guide-sidebar__toc-wrapper {
    flex: 1;
    overflow-y: auto;
    min-height: 0;
    scrollbar-width: thin;
    scrollbar-color: var(--color-sepia-light) transparent;
  }

  .guide-sidebar__toc-wrapper::-webkit-scrollbar {
    width: 6px;
  }

  .guide-sidebar__toc-wrapper::-webkit-scrollbar-track {
    background: transparent;
  }

  .guide-sidebar__toc-wrapper::-webkit-scrollbar-thumb {
    background-color: var(--color-sepia-light);
    border-radius: 3px;
  }

  .guide-sidebar__toc-wrapper::-webkit-scrollbar-thumb:hover {
    background-color: var(--color-sepia-medium);
  }

  .guide-sidebar__nav-section {
    margin-bottom: var(--space-sm);
    padding-bottom: var(--space-sm);
    border-bottom: 1px solid var(--color-parchment);
  }

  .guide-sidebar__title {
    font-family: var(--font-headline);
    font-size: var(--text-xs);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--color-sepia-medium);
    margin-bottom: var(--space-xs);
  }

  .guide-sidebar__nav {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .guide-sidebar__link {
    color: var(--color-blood-red);
    text-decoration: none;
    padding: var(--space-xs) var(--space-sm);
    background: var(--color-cream-dark);
    border-radius: var(--border-radius);
    transition: background var(--transition-fast);
    font-size: var(--text-xs);
  }

  .guide-sidebar__link:hover {
    background: var(--color-parchment);
  }

  /* Responsividade */
  @media (max-width: 968px) {
    .guide-layout {
      grid-template-columns: 1fr;
      padding: var(--space-lg) var(--space-md);
    }

    .guide-sidebar {
      order: -1;
    }

    .guide-sidebar__sticky {
      position: static;
      max-height: none;
      display: block;
    }

    .guide-sidebar__toc-wrapper {
      display: none;
    }

    .guide-sidebar__nav-section {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
  }

  @media (max-width: 768px) {
    .guide-layout {
      padding: var(--space-lg) var(--space-md);
    }

    .guide-content :global(h2) {
      font-size: var(--text-xl);
    }

    .guide-content :global(h3) {
      font-size: var(--text-lg);
    }

    .guide-content :global(table) {
      font-size: var(--text-xs);
    }

    .guide-content :global(th),
    .guide-content :global(td) {
      padding: var(--space-sm);
    }
  }

  @media (max-width: 480px) {
    .guide-layout {
      padding: var(--space-md) var(--space-sm);
    }

    .guide-content :global(h2) {
      font-size: var(--text-lg);
      margin: var(--space-xl) 0 var(--space-md);
    }

    .guide-content :global(h3) {
      font-size: var(--text-base);
    }

    .guide-content :global(ul),
    .guide-content :global(ol) {
      padding-left: var(--space-lg);
    }
  }
</style>
